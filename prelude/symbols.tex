\newenvironment{centered}{\centering}{\par}

\definecolor{highlight}{RGB}{230,255,230}
\definecolor{darkgreen}{RGB}{76,170,76}
\definecolor{lavender}{RGB}{162,85,162}

\newcommand{\mathcolorbox}[2]{\colorbox{#1}{$\displaystyle #2$}}
\newcommand{\hlfancy}[2]{\sethlcolor{#1}\hl{#2}}
\makeatletter
\renewcommand*{\@textcolor}[3]{%
  \protect\leavevmode
  \begingroup
    \color#1{#2}#3%
  \endgroup
}
\makeatother

\newcommand{\subsubsubsection}[1]{\paragraph{\textbf{\textit{#1}}}}

\theoremstyle{plain}
\newtheorem*{theorem}{Theorem}
\newtheorem*{lemma}{Lemma}

\newtheorem{theoremn}{Theorem}[section]
\newtheorem{lemman}[theoremn]{Lemma}

\theoremstyle{definition}
\newtheorem*{definition}{Definition}
\newtheorem*{base}{Base}
\newtheorem*{induction}{Induction}
\newtheorem*{fact}{Fact}

\newcommand{\rulen}[1]{~~\text{(#1)}}
\newcommand{\judgment}[3]{\inferrule{#1}{#2}\rulen{\textsc{#3}}}
\newcommand{\judgbox}[1]{\noindent \fbox{$#1$}}

% H-types
\newcommand{\HTyp}{\texttt{HTyp}}
\newcommand{\HTypCtx}{\dot{\Gamma}}
\newcommand{\HTypVar}{\dot{\tau}}
\newcommand{\HTypVarP}{\HTypVar'}
\newcommand{\HTypNum}{\texttt{num}}
\newcommand{\HTypStr}{\texttt{str}}
\newcommand{\HTypArrow}[2]{(#1 \to #2)}

% H-expressions
\newcommand{\HExp}{\texttt{HExp}}
\newcommand{\HExpVar}{\ensuremath{\dot{e}}}
\newcommand{\HExpVarP}{\ensuremath{\dot{e}'}}
\newcommand{\HExpStrLit}{\ensuremath{\texttt{"}\underline{s}\texttt{"}}}
\newcommand{\HExpStrSub}[3]{\ensuremath{#1\texttt{[}#2\texttt{:}#3\texttt{]}}}
\newcommand{\HExpStrConcatOp}{\ensuremath{\textsuperscript{$\bm{\wedge}$}}}
\newcommand{\HExpStrConcat}[2]{\ensuremath{#1\ \HExpStrConcatOp\ #2}}

% Z-types
\newcommand{\ZTypVar}{\ensuremath{\hat{\tau}}}
\newcommand{\ZTypVarP}{\ensuremath{\ZTypVar'}}

% Z-expressions
\newcommand{\ZExp}{\texttt{ZExp}}
\newcommand{\ZExpVar}{\ensuremath{\hat{e}}}
\newcommand{\ZExpVarP}{\ensuremath{\ZExpVar'}}
\newcommand{\ZExpCursor}[1]{\ensuremath{\mathcolorbox{highlight}{\textcolor{darkgreen}{\bm{\triangleright}}#1\textcolor{darkgreen}{\bm{\triangleleft}}}}}
\newcommand{\ZExpCursorEHole}{\ensuremath{\ZExpCursor{\ZExpEHole}}}
\newcommand{\ZExpNEHole}[1]{\ensuremath{\textcolor{lavender}{\bm{\llparenthesis}}#1\textcolor{lavender}{\bm{\rrparenthesis}}}}
\newcommand{\ZExpEHole}{\ensuremath{\ZExpNEHole{}}}
\newcommand{\ZExpStrConcat}[2]{\ensuremath{\ZExpCursor{\HExpStrConcat{#1}{#2}}}}
\newcommand{\ZExpStrConcatI}[2]{\ensuremath{\HExpStrConcat{\ZExpCursor{#1}}{#2}}}
\newcommand{\ZExpStrConcatII}[2]{\ensuremath{\HExpStrConcat{#1}{\ZExpCursor{#2}}}}
\newcommand{\ZExpStrSub}[3]{\ensuremath{\ZExpCursor{\HExpStrSub{#1}{#2}{#3}}}}
\newcommand{\ZExpStrSubI}[3]{\ensuremath{\HExpStrSub{\ZExpCursor{#1}}{#2}{#3}}}
\newcommand{\ZExpStrSubII}[3]{\ensuremath{\HExpStrSub{#1}{\ZExpCursor{#2}}{#3}}}
\newcommand{\ZExpStrSubIII}[3]{\ensuremath{\HExpStrSub{#1}{#2}{\ZExpCursor{#3}}}}

% IH-errors
\newcommand{\IHExcept}{\texttt{IHErr}}
\newcommand{\IHExceptVar}{\ensuremath{\epsilon}}
\newcommand{\IHExceptOOB}[3]{\ensuremath{\texttt{OOB}\{#1, [#2, #3]\}}}

% IH-expressions
\newcommand{\IHExp}{\texttt{IHExp}}
\newcommand{\IHExpVar}{\ensuremath{d}}
\newcommand{\IHExpVarP}{\ensuremath{\IHExpVar'}}
\newcommand{\IHExpCtx}[2]{\ensuremath{#1 \dashv #2}}
\newcommand{\IHExpNumLit}{\ensuremath{\underline{n}}}
\newcommand{\IHExpNumLitS}[1]{\ensuremath{\underline{n_#1}}}
\newcommand{\IHExpNumLitV}{\ensuremath{n}}
\newcommand{\IHExpNumLitVS}[1]{\ensuremath{n_#1}}
\newcommand{\IHExpStrLit}{\ensuremath{\texttt{"}\underline{s}\texttt{"}}}
\newcommand{\IHExpStrLitS}[1]{\ensuremath{\texttt{"}\underline{s_#1}\texttt{"}}}
\newcommand{\IHExpStrLitV}[1]{\ensuremath{\texttt{"}s\texttt{"}}}
\newcommand{\IHExpStrLitVS}[1]{\ensuremath{\texttt{"}s_#1\texttt{"}}}
\newcommand{\IHExpStrLitX}[1]{\ensuremath{\texttt{"}\underline{#1}\texttt{"}}}
\newcommand{\IHExpStrConcat}[2]{\ensuremath{#1\ \HExpStrConcatOp\ #2}}
\newcommand{\IHExpStrSub}[3]{\ensuremath{#1\texttt{[}#2\texttt{:}#3\texttt{]}}}
\newcommand{\IHExpStrLen}[1]{\ensuremath{\mathsf{len}(#1)}}
\newcommand{\IHExpHoleCtx}{\ensuremath{\Delta}}
\newcommand{\IHExpHoleCtxE}{\ensuremath{\cdot}}
\newcommand{\IHExpCast}[2]{\ensuremath{#1 \langle #2 \rangle}}
\newcommand{\IHExpCastTyp}[3]{\ensuremath{\IHExpCast{#1}{#2 \Rightarrow #3}}}
\newcommand{\IHExpCastExcept}[2]{\ensuremath{\IHExpCast{#1}{\IHExpExcept{#2}}}}
\newcommand{\IHExpCastExceptVar}[1]{\ensuremath{\IHExpCastExcept{#1}{\IHExceptVar}}}
\newcommand{\IHExpExcept}[1]{\ensuremath{#1}}
\newcommand{\IHExpExceptVar}{\ensuremath{\IHExpExcept{\IHExceptVar}}}
\newcommand{\IHExpExceptOOB}[3]{\ensuremath{\IHExpExcept{\IHExceptOOB{#1}{#2}{#3}}}}

% Action expressions
\newcommand{\AcSym}{\alpha}
\newcommand{\AcExpArrow}[2]{#1 \stackrel{\AcSym}{\longrightarrow} #2}
\newcommand{\AcExpMovChild}[3]{#2 \xrightarrow{\texttt{move child #1}} #3}
\newcommand{\AcExpMovParent}[2]{#1 \xrightarrow{\texttt{move parent}} #2}
\newcommand{\AcCon}[3]{#2 \xrightarrow{\texttt{construct #1}} #3}
\newcommand{\AcConStrLit}[2]{\AcCon{lit $\HExpStrLit$}{#1}{#2}}
\newcommand{\AcConStrConcat}[2]{\AcCon{concat}{#1}{#2}}
\newcommand{\AcConStrSub}[2]{\AcCon{subscript}{#1}{#2}}

% Elaboration expressions
\newcommand{\ElabArrow}[2]{#1 \leadsto #2}

% Evaluation expressions
\newcommand{\EvalCtx}{\mathcal{E}}
\newcommand{\EvalCtxEx}[2]{#1 = \EvalCtx\{#2\}}
\newcommand{\EvalCtxExF}[3]{#1 = #2\{#3\}}
\newcommand{\EvalTran}[2]{#1 \longrightarrow #2}

% Type rule expressions
\newcommand{\contextExpr}[2]{\ensuremath{#1 \vdash #2}}
\newcommand{\isConsistent}[2]{\ensuremath{#1 \sim #2}}
\newcommand{\isNotConsistent}[2]{\ensuremath{#1 \nsim #2}}
\newcommand{\hasType}[3]{\ensuremath{#1 \vdash #2 : #3}}
\newcommand{\hasTypeC}[2]{\ensuremath{#1 : #2}}
\newcommand{\hasTypeD}[4]{\ensuremath{#1; #2 \vdash #3 : #4}}
\newcommand{\hasTypeDX}[3]{\ensuremath{\hasTypeD{\Delta}{#1}{#2}{#3}}}
\newcommand{\synType}[3]{\ensuremath{#1 \vdash #2 \Rightarrow #3}}
\newcommand{\synTypeC}[2]{\ensuremath{#1 \Rightarrow #2}}
\newcommand{\synTypeD}[4]{\ensuremath{#1; #2 \vdash #3 \Rightarrow #4}}
\newcommand{\synTypeDX}[3]{\ensuremath{\synTypeD{\Delta}{#1}{#2}{#3}}}
\newcommand{\anaType}[3]{\ensuremath{#1 \vdash #2 \Leftarrow #3}}
\newcommand{\anaTypeC}[2]{\ensuremath{#1 \Leftarrow #2}}
\newcommand{\anaTypeD}[4]{\ensuremath{#1; #2 \vdash #3 \Leftarrow #4}}
\newcommand{\anaTypeDX}[3]{\ensuremath{\anaTypeD{\Delta}{#1}{#2}{#3}}}

\newcommand{\isGround}[1]{#1~\mathsf{ground}}
\newcommand{\isFinal}[1]{#1~\mathsf{final}}
\newcommand{\isVal}[1]{#1~\mathsf{val}}
\newcommand{\isIndet}[1]{#1~\mathsf{indet}}

\newcommand{\optPremise}[1]{\textcolor{red}{\bm{[}}#1\textcolor{red}{\bm{]}}}
