% {{{ Prelude
\documentclass[12pt]{article}

\input{prelude.tex}
% }}}

\begin{document}

\section{Strings}

We extend the syntax as follows, assuming $s$ is a sequence of characters:
%
\begin{center}
  \vspace*{-1.5em}
  \[\begin{array}{rccl}
    \HTyp  & \HTypVar  & \Coloneqq & \cdots \mid \HTypStrC                                                  \\
    \HExp  & \HExpVar  & \Coloneqq & \cdots \mid \HExpStrLit \mid \HExpStrSub{\HExpVar}{\HExpVar}{\HExpVar}      \\
    \IHExp & \IHExpVar & \Coloneqq & \cdots \mid \IHExpStrLit \mid \IHExpStrSub{\IHExpVar}{\IHExpVar}{\IHExpVar} \\
  \end{array}\]
\end{center}

\subsection{H-Types and H-Expressions}

\subsubsection{Type Compatibility and Incompatibility}
\judgbox{\isNotConsistent{\HTypVar}{\HTypVarP}}
%
\begin{mathpar}
  \judgment{ }{\isNotConsistent{\HTypStrC}{\HTypArrowC{\HTypVar_1}{\HTypVar_2}}}{HTICStrArr1} \\
  \judgment{ }{\isNotConsistent{\HTypArrowC{\HTypVar_1}{\HTypVar_2}}{\HTypStrC}}{HTICStrArr2}
\end{mathpar}

\subsubsection{Synthesis and Analysis}
\judgbox{\synType{\HTypCtx}{\HExpVar}{\HTypVar}}
%
\begin{mathpar}
  \judgment{ }{\synType{\HTypCtx}{\HExpStrLit}{\HTypStrC}}{HTypSStrLit} \\

  \judgment{
    \anaType{\HTypCtx}{\HExpVar_1}{\HTypStrC} \\
    \anaType{\HTypCtx}{\HExpVar_2}{\HTypNumC} \\
    \anaType{\HTypCtx}{\HExpVar_3}{\HTypNumC}
  }{
    \synType{\HTypCtx}{\HExpStrSub{\HExpVar_1}{\HExpVar_2}{\HExpVar_3}}{\HTypStrC}
  }{HTSStrSub}
\end{mathpar}

\subsection{Action Model}
\judgbox{\AcExpArrow{\ZTypVar}{\ZTypVarP}}

\subsubsection{Expression Movement Actions}

\subsubsubsection{\textbf{\textit{Subscript}}}
%
\begin{mathpar}
  \newcommand{\AcExpMovStrSubChild}[2]{
    \judgment{
    }{
      \AcExpMovChild{#1}{\ZExpStrSub{\HExpVar_1}{\HExpVar_2}{\HExpVar_3}}{#2}
    }{AEMStrSubChild#1}
  }
  %
  \newcommand{\AcExpMovStrSubParent}[2]{
    \judgment{
    }{
      \AcExpMovParent{#2}{\ZExpStrSub{\HExpVar_1}{\HExpVar_2}{\HExpVar_3}}
    }{AEMStrSubParent#1}
  }
  %
  \AcExpMovStrSubChild{1}{\ZExpStrSubI{\HExpVar_1}{\HExpVar_2}{\HExpVar_3}} \\
  \AcExpMovStrSubChild{2}{\ZExpStrSubII{\HExpVar_1}{\HExpVar_2}{\HExpVar_3}} \\
  \AcExpMovStrSubChild{3}{\ZExpStrSubIII{\HExpVar_1}{\HExpVar_2}{\HExpVar_3}} \\
  %
  \AcExpMovStrSubParent{1}{\ZExpStrSubI{\HExpVar_1}{\HExpVar_2}{\HExpVar_3}} \\
  \AcExpMovStrSubParent{2}{\ZExpStrSubII{\HExpVar_1}{\HExpVar_2}{\HExpVar_3}} \\
  \AcExpMovStrSubParent{3}{\ZExpStrSubIII{\HExpVar_1}{\HExpVar_2}{\HExpVar_3}}

\end{mathpar}

\subsubsection{Synthetic and Analytic Expression Actions}
\judgbox{\AcExpArrow{\synType{\HTypCtx}{\ZExpVar}{\HTypVar}}{\synTypeC{\ZExpVarP}{\HTypVarP}}}

\subsubsubsection{Construction}
%
\begin{mathpar}
  \judgment{
  }{
    \AcConStrLit{
      \synType{\HTypCtx}{\ZExpCursorEHole}{\ZExpEHole}
    }{
      \synTypeC{\ZExpCursor{\HExpStrLit}}{\HTypStrC}
    }
  }{ASConStrLit} \\

  \judgment{
    \isConsistent{\HTypVar}{\HTypStrC}
  }{
    \AcConStrSub{
      \synType{\HTypCtx}{\ZExpCursor{\HExpVar}}{\HTypVar}
    }{
      \synTypeC{\ZExpStrSubII{\HExpVar}{\ZExpEHole}{\ZExpEHole}}{\HTypStrC}
    }
  }{ASConStrSub1} \\

  \judgment{
    \isNotConsistent{\HTypVar}{\HTypStrC}
  }{
    \AcConStrSub{
      \synType{\HTypCtx}{\ZExpCursor{\HExpVar}}{\HTypVar}
    }{
      \synTypeC{\ZExpStrSubII{\ZExpNEHole{\HExpVar}}{\ZExpEHole}{\ZExpEHole}}{\HTypStrC}
    }
  }{ASConStrSub2}
\end{mathpar}

\judgbox{\AcExpArrow{\contextExpr{\HTypCtx}{\ZExpVar}}{\anaTypeC{\ZExpVarP}{\HTypVar}}}

\subsubsubsection{Construction}
%
\begin{mathpar}
  \judgment{
    \isNotConsistent{\HTypVar}{\HTypStrC}
  }{
    \AcConStrLit{
      \contextExpr{\HTypCtx}{\ZExpCursorEHole}
    }{
      \anaTypeC{\ZExpNEHole{\ZExpCursor{\HExpStrLit}}}{\HTypVar}
    }
  }{AAConStrLit} \\
\end{mathpar}

\subsection{Elaboration}

\judgbox{\ElabArrow{\synType{\HTypCtx}{\HExpVar}{\HTypVar}}{\IHExpCtx{d}{\Delta}}}
        {~~$\HExpVar$ synthesizes type $\HTypVar$ and elaborates to $\IHExpVar$}

\begin{mathpar}
  \judgment{
  }{
    \ElabArrow{\synType{\Gamma}{\HExpStrLit}{\HTypVar}}{\IHExpCtx{\IHExpStrLit}{\IHExpHoleCtxE}}
  }{ELStrLit}

  \judgment{
    \ElabArrow{\anaType{\HTypCtx}{\HExpVar_1}{\HTypStrC}}{\IHExpCtx{\hasTypeC{\IHExpVar_1}{\HTypStrC}}{\IHExpHoleCtx_1}} \\
    \ElabArrow{\anaType{\HTypCtx}{\HExpVar_2}{\HTypNumC}}{\IHExpCtx{\hasTypeC{\IHExpVar_2}{\HTypNumC}}{\IHExpHoleCtx_2}} \\
    \ElabArrow{\anaType{\HTypCtx}{\HExpVar_3}{\HTypNumC}}{\IHExpCtx{\hasTypeC{\IHExpVar_3}{\HTypNumC}}{\IHExpHoleCtx_3}} \\
  }{
    \ElabArrow{
      \synType{\HTypCtx}{\HExpStrSub{\HExpVar_1}{\HExpVar_2}{\HExpVar_3}}{\HTypStrC}
    }{
      \IHExpCtx{\IHExpStrSub{\IHExpVar_1}{\IHExpVar_2}{\IHExpVar_3}}{\IHExpHoleCtx_1 \cup \IHExpHoleCtx_2 \cup \IHExpHoleCtx_3}
    }
  }{ELStrSub}
\end{mathpar}

\subsection{Dynamic Semantics}

\subsubsection{IH-Expression Types}
\judgbox{\hasType{\Delta; \HTypCtx}{d}{\HTypVar}}
        {~~$\IHExpVar$ is assigned type $\HTypVar$}

\begin{mathpar}
  \judgment{
  }{
    \hasType{\Delta; \HTypCtx}{\IHExpStrLit}{\HTypStrC}
  }{IHTStrLit}

  \judgment{
    \hasType{\Delta; \HTypCtx}{\IHExpVar_1}{\HTypStrC} \\
    \hasType{\Delta; \HTypCtx}{\IHExpVar_2}{\HTypNumC} \\
    \hasType{\Delta; \HTypCtx}{\IHExpVar_3}{\HTypNumC} \\
  }{
    \hasType{\Delta; \HTypCtx}{\IHExpStrSub{\IHExpVar_1}{\IHExpVar_2}{\IHExpVar_3}}{\HTypStrC}
  }{IHTStrSub}
\end{mathpar}

\end{document}
